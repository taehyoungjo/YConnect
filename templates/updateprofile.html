{% extends "layout.html" %}

{% block title %}
    Update Profile
{% endblock %}

{% block main %}
<form action="/updateprofile" method="post" enctype=multipart/form-data>

    <h2><u>Personal Info</u></h2>
    <div class="form-group">
        <input autocomplete="off" autofocus class="form-control" name="name" placeholder="Name" type="text">
    </div>
    <div class="form-group">
        <select autocomplete="off" autofocus class="form-control" name="major" placeholder="Major">
          <option value="" selected disabled>Major</option>
          {% for id in majors %}
          <option value="{{id["id"]}}">{{ id["id"] }}</option>
          {% endfor %}
        </select>
    </div>
    <div class="form-group">
        <select autocomplete="off" autofocus class="form-control" name="year" placeholder="Year">
            <option value="" selected disabled>Class</option>
            <option value="2019">2019</option>
            <option value="2020">2020</option>
            <option value="2021">2021</option>
            <option value="2022">2022</option>
        </select>
    </div>

    <div class="form-group">
        <select autocomplete="off" autofocus class="form-control" name="residential_college" placeholder="Residential College">
            <option value="" selected disabled>Residential College</option>
            <option value="Benjamin Franklin">Benjamin Franklin</option>
            <option value="Berkeley">Berkeley</option>
            <option value="Branford">Branford</option>
            <option value="Davenport">Davenport</option>
            <option value="Ezra Stiles">Ezra Stiles</option>
            <option value="Grace Hopper">Grace Hopper</option>
            <option value="Jonathan Edwards">Jonathan Edwards</option>
            <option value="Morse">Morse</option>
            <option value="Pauli Murray">Pauli Murray</option>
            <option value="Pierson">Pierson</option>
            <option value="Saybrook">Saybrook</option>
            <option value="Silliman">Silliman</option>
            <option value="Timothy Dwight">Timothy Dwight</option>
            <option value="Trumbull">Trumbull</option>
        </select>
    </div>

    <div class="form-group">
        <label for="file">Profile Picture</label>
        <input type="file" class="form-control-file" name="file" id="file">
    </div>

    <div class="form-group">
        <textarea class="form-control" placeholder="bio" name="bio" rows="3"></textarea>
    </div>

    <p>&nbsp;</p>

    <h2><u>Class Selection</u></h2>

    <div class="form-group" >
        <input autocomplete="off" autofocus class="form-control" name="class_id" id="class_id" placeholder="Class ID" onkeyup="search();" type="text">
    </div>

    <table class="table">
        <thead id="results_head"></thead>
        <tbody id="results"></tbody>

    </table>

    <p>&nbsp;</p>

    <h2><u>Selected Classes</u></h2>

    <table class="table">
        <thead id="courses_head"></thead>
        <tbody id="courses"></tbody>
    </table>

    <p>&nbsp;</p>

    <div>
        <button class="btn btn-primary" type="submit" id="submit">Update</button>
    </div>
</form>

<script>

    let class_id = document.getElementById('class_id');

    function search() {
        $.get('/class_search?class_id=' + class_id.value, function(data) {
            let head_html = '<tr><th scope="col">Offered Class ID</th><th scope="col">Offered Class Name</th></tr>'
            let html = '';
            for (class_info of data) {
                html += '<tr><td><div class="form-check"><input class="form-check-input" type="checkbox" value="'
                        + class_info["class_id"]
                        + '" onclick="addclass($(this))" id="class_id"'
                        + '><label class="form-check-label" for="defaultCheck1">'
                        + class_info["class_id"]
                        + '</label></div></td><td>'
                        + class_info["class_name"]
                        + '</td><div class=row id="results"></div></tr>'
            }
            console.log(html)
            document.getElementById("results").innerHTML = html;
            document.getElementById("results_head").innerHTML = head_html;
        });
    };

    //based on: https://stackoverflow.com/questions/28372466/how-to-call-a-function-from-checkbox-onclick-or-onchange
    function addclass(input) {
        console.log(input);
        console.log(input[0]['value'])
        $.get('/class_change?class_id=' + input[0]['value'], function(data) {
            let html = ''
            let head_html = '<tr><th scope="col">Registered Class ID</th><th scope="col">Registered Class Name</th></tr>'
            console.log(data[1]["course_id"])
            for (class_info of data) {
                    html += '<tr><td><div class="form-check"><input class="form-check-input" type="checkbox" value="'
                            + class_info["course_id"]
                            + '" onclick="addclass" id="'
                            + class_info["course_id"]
                            + '"><label class="form-check-label" for="defaultCheck1">'
                            + class_info["course_id"]
                            + '</label></div></td><td>'
                            + class_info["class_name"]
                            + '</td><div class=row id="results"></div></tr>'
                        }


            document.getElementById("courses").innerHTML = html;
            document.getElementById("courses_head").innerHTML = head_html;
        });
    };
</script>

{% endblock %}